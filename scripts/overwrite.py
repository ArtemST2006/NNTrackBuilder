import json
from pathlib import Path
import traceback
from typing import List, Dict, Any

SEMANTIC_TAGS_MAP = {
    "аквапарк": ["водные развлечения", "для семей с детьми", "летний досуг", "активный отдых", "платная услуга"],
    "арт_кластер": ["искусство", "творчество", "культура", "выставки", "фотосессии"],
    "арт-пространство": ["искусство", "творчество", "культура", "выставки", "фотосессии"],
    "аттракционы": ["развлечения", "для семей с детьми", "активный отдых", "для молодежи", "платная услуга"],
    "архитектурный_памятник": ["архитектура", "история", "культурное наследие", "фотосессии", "туристический"],
    "бар": ["ночной досуг", "коктейли", "социальное место", "музыка", "для взрослых"],
    "ботанический_сад": ["природа", "флора", "прогулки", "образование", "для семей"],
    "вестибюль_фуникулера": ["панорама города", "вид на город", "фотосессии", "туристический", "популярное место"],
    "водная_прогулка_причал": ["водные развлечения", "прогулки", "природа", "для семей", "панорама города"],
    "выставочный_зал": ["искусство", "культура", "выставки", "образование", "фотосессии"],
    "выставочный_центр": ["искусство", "культура", "выставки", "образование", "мероприятия"],
    "галерея": ["искусство", "культура", "выставки", "образование", "фотосессии"],
    "гастрономический_рынок": ["гастрономия", "еда", "шопинг", "социальное место", "популярное место"],
    "дом_культуры": ["культура", "мероприятия", "выступления", "образование", "социальное место"],
    "завод_красное_сормово": ["история", "промышленность", "архитектура", "туристический", "образование"],
    "зоопарк": ["животные", "природа", "для семей с детьми", "образование", "экскурсии"],
    "исторический_район": ["история", "архитектура", "культурное наследие", "прогулки", "туристический"],
    "канатная_дорога": ["панорама города", "вид на город", "активный отдых", "фотосессии", "туристический"],
    "кафе": ["еда", "напитки", "социальное место", "деловые встречи", "релаксация"],
    "кинотеатр": ["кино", "развлечения", "семейный досуг", "для молодежи", "платная услуга"],
    "колесо_обозрения": ["панорама города", "вид на город", "активный отдых", "для семей", "туристический"],
    "кондитерская": ["сладости", "еда", "кулинария", "для семей", "гастрономия"],
    "концертный_зал": ["музыка", "искусство", "выступления", "культура", "платная услуга"],
    "кофейня": ["еда", "напитки", "социальное место", "релаксация", "для встреч"],
    "крепость": ["история", "архитектура", "культурное наследие", "образование", "туристический"],
    "культурный_центр": ["культура", "мероприятия", "выступления", "образование", "социальное место"],
    "ледовый_городок": ["зимний спорт", "зимние развлечения", "для семей", "активный отдых", "сезонный"],
    "монастырь": ["религия", "история", "архитектура", "культурное наследие", "спокойный отдых"],
    "мост": ["архитектура", "вид на город", "фотосессии", "туристический", "прогулки"],
    "музей": ["история", "культура", "образование", "экскурсии", "туристический"],
    "набережная": ["природа", "прогулки", "водоёмы", "панорама", "спокойный отдых"],
    "ночной_клуб": ["развлечения", "ночной досуг", "музыка", "для молодежи", "танцы"],
    "океанариум": ["животные", "морская жизнь", "для семей с детьми", "образование", "экскурсии"],
    "оперный_театр": ["искусство", "музыка", "театр", "культура", "выступления"],
    "памятник": ["история", "архитектура", "культурное наследие", "фотосессии", "образование"],
    "парк": ["природа", "прогулки", "релаксация", "для семей", "спокойный отдых"],
    "пекарня": ["еда", "хлеб", "кулинария", "для семей", "гастрономия"],
    "пляж": ["водные развлечения", "летний досуг", "природа", "релаксация", "для семей"],
    "площадка_фестивальная": ["события", "мероприятия", "культура", "развлечения", "социальное место"],
    "площадка_смотровая": ["панорама города", "вид на город", "фотосессии", "туристический", "прогулки"],
    "смотровая_площадка": ["панорама города", "вид на город", "фотосессии", "туристический", "прогулки"],
    "планетарий": ["наука", "образование", "астрономия", "для семей", "интеллектуальный"],
    "ресторан": ["еда", "гастрономия", "деловые встречи", "романтичное", "социальное место"],
    "речной_вокзал": ["транспорт", "путешествия", "туристический", "история", "общественное место"],
    "рынок_туристический": ["шопинг", "сувениры", "туристический", "подарки", "популярное место"],
    "рынок_сувениров": ["шопинг", "сувениры", "туристический", "подарки", "популярное место"],
    "сквер": ["природа", "прогулки", "релаксация", "спокойный отдых", "фотосессии"],
    "скульптура": ["искусство", "архитектура", "культурное наследие", "фотосессии", "образование"],
    "собор": ["религия", "история", "архитектура", "культурное наследие", "спокойный отдых"],
    "собор_александра_невского": ["религия", "история", "архитектура", "культурное наследие", "туристический"],
    "сувенирный_магазин": ["шопинг", "сувениры", "подарки", "туристический", "ремесла"],
    "театр": ["искусство", "театр", "выступления", "культура", "платная услуга"],
    "туристический_инфоцентр": ["туристический", "информация", "помощь", "планирование", "рекомендации"],
    "универмаг_исторический": ["шопинг", "история", "архитектура", "культурное наследие", "туристический"],
    "усадьба": ["история", "архитектура", "культурное наследие", "образование", "туристический"],
    "филармония": ["музыка", "искусство", "культура", "выступления", "платная услуга"],
    "фонтан": ["архитектура", "природа", "городской дизайн", "фотосессии", "спокойный отдых"],
    "храм": ["религия", "история", "архитектура", "культурное наследие", "спокойный отдых"],
    "церковь": ["религия", "история", "архитектура", "культурное наследие", "спокойный отдых"],
    "цирк": ["развлечения", "для семей с детьми", "для молодежи", "искусство", "платная услуга"],
    "чайная": ["еда", "напитки", "социальное место", "релаксация", "для встреч"],
    "часовня": ["религия", "история", "архитектура", "культурное наследие", "спокойный отдых"],
    "экстрим_парк": ["активный спорт", "экстремальный спорт", "для молодежи", "адреналин", "платная услуга"],
    "ярмарка": ["события", "мероприятия", "шопинг", "для семей", "развлечения"]
}


def overwrite_semantic_tags(input_file: str, output_file: str) -> Dict[str, Any]:
    with open(input_file, 'r', encoding='utf-8') as f:
        places = json.load(f)

    for idx, place in enumerate(places):
        search_category = place.get('search_category', '')

        if search_category in SEMANTIC_TAGS_MAP:
            tags = SEMANTIC_TAGS_MAP[search_category]
            place['semantic_tags'] = tags

        if (idx + 1) % 500 == 0:
            print(f"{idx + 1}/{len(places)} мест обработано")

    Path(output_file).parent.mkdir(parents=True, exist_ok=True)

    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(places, f, ensure_ascii=False, indent=2)

    print(f"Сохранено в {output_file}\n")

    # return stats


def main():
    script_dir = Path(__file__).parent.parent

    input_file = script_dir / 'data' / 'processed' / 'all_places.json'
    output_file = script_dir / 'data' / 'raw' / 'all_places_semantic_tags_updated.json'

    overwrite_semantic_tags(str(input_file), str(output_file))

    print(f"   Файл: {output_file}\n")


if __name__ == "__main__":
    try:
        main()
    except Exception as e:
        print(f"\nНеожиданная ошибка: {e}")
        traceback.print_exc()
        exit(1)
